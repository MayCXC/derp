#!/usr/bin/env sh
. "envy.sh"

envd "$@"

if [ "${ENVP-o}" = "${ENVP-x}" ]; then
	mkdir -p -- "${ENVP}"
	ENVP="$(realpath -- "${ENVP}")"
	(
		envd "$(dirname -- "${0}")"
		cp -H -- "envy" "envy.sh" "env.sh" "${ENVP}"
	)
fi

cat > envy <<-EOT
	#!/usr/bin/env sh
	EOT

if [ "${ENVP-o}" = "${ENVP-x}" ]; then
	cat >> envy <<-EOT
		export PATH="${ENVP}:\${PATH}"
		EOT
fi

cat >> envy <<-EOT
	. "envy.sh"
	envy "\$@"
	EOT

chmod -- +x envy

cat > env.sh <<-EOT
	. "env.sh"
	EOT
