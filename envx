#!/usr/bin/env sh
. "envy.sh"

envd "$@"

if [ "${ENVP-o}" = "${ENVP-x}" ]; then
	ENVD="$(dirname -- "${0}")"
	mkdir -p -- "${ENVP}"
	cp -H -- "${ENVD}/envy.sh" "${ENVD}/env.sh" "${ENVP}"
fi

cat > envy <<-EOT
	#!/usr/bin/env sh
	. "envy.sh"
	EOT

if [ "${ENVP-o}" = "${ENVP-x}" ]; then
	cat >> envy <<-EOT
		ENVP=\$(
			envd "\$(dirname -- "\${0}")"
			realpath -- "${ENVP}"
		)
		export PATH="\${ENVP}:\${PATH}"
		EOT
fi

cat >> envy <<-EOT
	envy "\$@"
	EOT

chmod -- +x envy

cat > env.sh <<-EOT
	. "env.sh"
	EOT
