#!/usr/bin/env sh

: ${ENV="env.sh"}
: ${ENVS=""}
: ${ENVY=$(
	ABSENVY="${PWD%"/"}/${0#"/"}.sh"
	cd $(dirname -- "${ABSENVY}")
	cat <<-EOT
		${PWD}/$(basename -- "${ABSENVY}")
		EOT
	)}

TAIL=0
ENVSARGS=""

getenvs () {
	ENVSARGS="$*"
	while [ $# -gt 0 ]; do
		if [ $1 = "--" ]; then
			TAIL=$#
			shift
			ENVSARGS="$*"
		else
			shift
		fi
	done
	set -- ${ENVS} ${ENVSARGS}
	ENVS="$*"
}

if [ "${IFS-o}" = "${IFS-x}" ]; then
	getenvs
else
	IFS=":"
	getenvs
	unset IFS
fi

SPIN=${TAIL}

while [ ${SPIN} -gt 0 ]; do
	HEAD="${1}"
	shift
	set -- "$@" "${HEAD}"
	SPIN=$((SPIN-1))
done

shift $TAIL

export ENV
export ENVS
export ENVY
# POSIX User Portability Utilities sh
exec sh "${@}"
